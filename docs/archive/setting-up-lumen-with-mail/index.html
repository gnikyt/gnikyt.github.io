<!--
  Hello! Lookin' for something? Well... it was built quickly, hope thats OK with you!
  https://github.com/gnikyt/gnikyt.github.io
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>
      Lumen with Mailer | gnikyt
    </title>
    <link href="https://gnikyt.com/setting-up-lumen-with-mail" rel="canonical">
    <meta content="Custom" name="generator">
    <meta content=
    "## What is Lumen [Lumen](https://lumen.laravel.com/) is a micro-framework built by Laravel. Its geared towards small services like APIs..."
    name="description">
    <meta content="2017-11-19T11:04:33-0330" property="article:published_time">
    <meta content="Lumen with Mailer" property="og:title">
    <meta content="en" property="og:locale">
    <meta content=
    "## What is Lumen [Lumen](https://lumen.laravel.com/) is a micro-framework built by Laravel. Its geared towards small services like APIs..."
    property="og:description">
    <meta content="https://gnikyt.com/setting-up-lumen-with-mail" property="og:url">
    <meta content="gnikyt" property="og:site_name">
    <meta content="article" property="og:type">
    <meta content="summary" name="twitter:card">
    <meta content=
    "## What is Lumen [Lumen](https://lumen.laravel.com/) is a micro-framework built by Laravel. Its geared towards small services like APIs..."
    property="twitter:title">
    <script type="application/ld+json">
    {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "dateModified": "2017-11-19T11:04:33-0330",
    "datePublished": "2017-11-19T11:04:33-0330",
    "description": "
    ## What is Lumen

    [Lumen](https://lumen.laravel.com/) is a micro-framework built by Laravel. Its geared towards small services like APIs...",
    "headline": "Lumen with Mailer",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://gnikyt.com/setting-up-lumen-with-mail"
    },
    "publisher": {
      "@type": "Organization",
      "logo": {
        "@type": "ImageObject",
        "url": "https://gnikyt.com/assets/favicon-32x32.png"
      }
    },
    "url": "https://gnikyt.com/setting-up-lumen-with-mail"
    }
    </script>
    <link as="font" crossorigin="anonymous" href="/assets/fonts/RobotoMono-Regular.woff2" rel="preload" type=
    "font/woff2">
    <link as="font" crossorigin="anonymous" href="/assets/fonts/RobotoMono-Bold.woff2" rel="preload" type="font/woff2">
    <link as="font" crossorigin="anonymous" href="/assets/fonts/RobotoMono-Light.woff2" rel="preload" type=
    "font/woff2">
    <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="/assets/images/favicon.png" rel="icon" sizes="32x32" type="image/png">
    <link href="/rss.xml" rel="alternate" title="gnikyt feed" type="application/rss+xml">
    <link href="/assets/styles/style.css" rel="stylesheet">
    <link href="/assets/styles/highlight.css" rel="stylesheet">
  </head>
  <body class="layout layout--post" data-handle="setting-up-lumen-with-mail">
    <header class="site-head container">
      <div class="site-head__item">
        <div class="site-head__title">
          <div class="site-head__title-inner">
            <span class="site-head__title-item"><a class="site-head__link" href="/">gnikyt</a></span> <span class=
            "site-head__title-item site-head__title-item--tag"><span>&nbsp;&nbsp;</span>/&nbsp;&nbsp;Code
            ramblings</span>
          </div>

          <div class="site-head__title-inner">
            <a class="site-head__avatar" href="/about"><img alt="Ty King" class="site-head__avatar-img" src=
            "/assets/images/me.jpg"></a>
          </div>
        </div>

        <div class="site-nav">
          <a class="button button--strong" href="/about">About</a><a class="button button--strong" href=
          "https://github.com/gnikyt" rel="noopener" target="_blank">Github</a><a class="button button--strong" href=
          "https://linkedin.com/in/gnikyt" rel="noopener" target="_blank">LinkedIn</a><a class="button button--strong"
          href="/assets/files/cv.pdf" target="_blank">CV</a><a class="button button--strong" href="/rss.xml" target=
          "_blank">RSS</a>
        </div>
      </div>
    </header>

    <main class="container">
      <article class="tab post">
        <header class="post__head">
          <h1 class="tab__title tab__title--short post__title">
            Lumen with Mailer /
          </h1>
        </header>

        <div class="tab__container">
          <div class="tab__content">
            <div class="post__meta content-container">
              <div class="post__details">
                /* <time class="post__time" datetime="2017-11-19">Nov 19,
                2017</time>&nbsp;&nbsp;—&nbsp;&nbsp;<span class="post__size">5.3KB</span> */
              </div>

              <div class="post__category">
                <a href="/category/php"><img alt="Logo of php" class="post__category-logo" src=
                "/assets/images/category-php.svg"></a> <a href="/category/laravel"><img alt="Logo of laravel" class=
                "post__category-logo" src="/assets/images/category-laravel.svg"></a>
              </div>
            </div>

            <div class="content-container">
              <h2 id="what-is-lumen">
                What is Lumen
              </h2>

              <p>
                <a href="https://lumen.laravel.com/">Lumen</a> is a micro-framework built by Laravel. Its geared
                towards small services like APIs, job handling, or very small projects. Laravel is all-inclusive,
                whereas Lumen is more bare-bones but moderately featured; however, it doesn’t feel as lean as something
                like Slim.
              </p>

              <h2 id="setting-up-mailing">
                Setting Up Mailing
              </h2>

              <p>
                Recently I ported a small app from Sinatra to Lumen for trial with a client. Its a job processing app
                for Shopify, where it would take data from a webhook, process it with a worker, and send back some data
                later. It needed to be fast, as, like other webhook-focused apps, it has to keep up with the high
                demand.
              </p>

              <p>
                One issue I ran into was mailing, it’s not enabled by default in Lumen, and there are many posts
                throughout Google of people attempting to set it up. There are also many outdated ways which only
                worked for the old version of Lumen.
              </p>

              <p>
                Through trial and error, I managed to find a working setup I thought I would share.
              </p>

              <h3 id="setup">
                Setup
              </h3>

              <p>
                First, run <code>composer require illuminate/mail:5.5</code> to grab the mailing component.
              </p>

              <p>
                Next, open <code>bootstrap/app.php</code>, find
                <code>$app-&gt;register(App\Providers\AppServiceProvider::class);</code> and uncomment it, if not
                already.
              </p>

              <p>
                After this is done, open the app provider in <code>app/Providers/</code>.
              </p>

              <p>
                At the bottom of the <code>register</code> method, paste in the following:
              </p>

              <div class="sourceCode" id="cb1">
                <pre class="sourceCode php"><code class="sourceCode php"><span id="cb1-1"><a aria-hidden="true" href=
                "#cb1-1" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4" tabindex="-1"></a><span class="co">// Init mailer</span></span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5" tabindex="-1"></a><span class=
"va">$this</span>-&gt;app-&gt;singleton(</span>
<span id="cb1-6"><a aria-hidden="true" href="#cb1-6" tabindex="-1"></a>    <span class="st">'mailer'</span><span class=
"ot">,</span></span>
<span id="cb1-7"><a aria-hidden="true" href="#cb1-7" tabindex="-1"></a>    <span class=
"kw">function</span> (<span class="va">$app</span>) {</span>
<span id="cb1-8"><a aria-hidden="true" href="#cb1-8" tabindex="-1"></a>        <span class=
"cf">return</span> <span class="va">$app</span>-&gt;loadComponent(<span class="st">'mail'</span><span class=
"ot">,</span> <span class="st">'Illuminate\Mail\MailServiceProvider'</span><span class="ot">,</span> <span class=
"st">'mailer'</span>)<span class="ot">;</span></span>
<span id="cb1-9"><a aria-hidden="true" href="#cb1-9" tabindex="-1"></a>    }</span>
<span id="cb1-10"><a aria-hidden="true" href="#cb1-10" tabindex="-1"></a>)<span class="ot">;</span></span>
<span id="cb1-11"><a aria-hidden="true" href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a aria-hidden="true" href="#cb1-12" tabindex="-1"></a><span class="co">// Aliases</span></span>
<span id="cb1-13"><a aria-hidden="true" href="#cb1-13" tabindex="-1"></a><span class=
"va">$this</span>-&gt;app-&gt;alias(<span class="st">'mailer'</span><span class="ot">,</span> \<span class=
"cn">I</span>lluminate\<span class="cn">C</span>ontracts\<span class="fu">Mail</span>\<span class=
"cn">M</span>ailer::<span class="kw">class</span>)<span class="ot">;</span></span></code></pre>
              </div>

              <p>
                To make mailing queue-able and able to be processed in the background, simply add:
              </p>

              <div class="sourceCode" id="cb2">
                <pre class="sourceCode php"><code class="sourceCode php"><span id="cb2-1"><a aria-hidden="true" href=
                "#cb2-1" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4" tabindex="-1"></a><span class="co">// Enable queues</span></span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5" tabindex="-1"></a><span class=
"va">$this</span>-&gt;app-&gt;make(<span class="st">'queue'</span>)<span class="ot">;</span>  </span></code></pre>
              </div>

              <p>
                And see my Lumen Redis tutorial to setup Redis for processing.
              </p>

              <p>
                Next, setup the basic config <code>config/mail.php</code>:
              </p>

              <div class="sourceCode" id="cb3">
                <pre class="sourceCode php"><code class="sourceCode php"><span id="cb3-1"><a aria-hidden="true" href=
                "#cb3-1" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a><span class="cf">return</span> [</span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4" tabindex="-1"></a>    <span class=
"st">'driver'</span> =&gt; env(<span class="st">'MAIL_DRIVER'</span>)<span class="ot">,</span></span>
<span id="cb3-5"><a aria-hidden="true" href="#cb3-5" tabindex="-1"></a>    <span class=
"st">'host'</span> =&gt; env(<span class="st">'MAIL_HOST'</span>)<span class="ot">,</span></span>
<span id="cb3-6"><a aria-hidden="true" href="#cb3-6" tabindex="-1"></a>    <span class=
"st">'port'</span> =&gt; env(<span class="st">'MAIL_PORT'</span>)<span class="ot">,</span></span>
<span id="cb3-7"><a aria-hidden="true" href="#cb3-7" tabindex="-1"></a>    <span class=
"st">'from'</span> =&gt; [</span>
<span id="cb3-8"><a aria-hidden="true" href="#cb3-8" tabindex="-1"></a>        <span class=
"st">'address'</span> =&gt; env(<span class="st">'MAIL_FROM_ADDRESS'</span>)<span class="ot">,</span></span>
<span id="cb3-9"><a aria-hidden="true" href="#cb3-9" tabindex="-1"></a>        <span class=
"st">'name'</span> =&gt; env(<span class="st">'MAIL_FROM_NAME'</span>)<span class="ot">,</span></span>
<span id="cb3-10"><a aria-hidden="true" href="#cb3-10" tabindex="-1"></a>    ]<span class="ot">,</span></span>
<span id="cb3-11"><a aria-hidden="true" href="#cb3-11" tabindex="-1"></a>    <span class=
"st">'encryption'</span> =&gt; env(<span class="st">'MAIL_ENCRYPTION'</span>)<span class="ot">,</span></span>
<span id="cb3-12"><a aria-hidden="true" href="#cb3-12" tabindex="-1"></a>    <span class=
"st">'username'</span> =&gt; env(<span class="st">'MAIL_USERNAME'</span>)<span class="ot">,</span></span>
<span id="cb3-13"><a aria-hidden="true" href="#cb3-13" tabindex="-1"></a>    <span class=
"st">'password'</span> =&gt; env(<span class="st">'MAIL_PASSWORD'</span>)<span class="ot">,</span></span>
<span id="cb3-14"><a aria-hidden="true" href="#cb3-14" tabindex="-1"></a>    <span class=
"st">'markdown'</span> =&gt; [</span>
<span id="cb3-15"><a aria-hidden="true" href="#cb3-15" tabindex="-1"></a>        <span class=
"st">'theme'</span> =&gt; <span class="st">'default'</span><span class="ot">,</span></span>
<span id="cb3-16"><a aria-hidden="true" href="#cb3-16" tabindex="-1"></a>        <span class=
"st">'paths'</span> =&gt; [</span>
<span id="cb3-17"><a aria-hidden="true" href="#cb3-17" tabindex="-1"></a>            resource_path(<span class=
"st">'views/vendor/mail'</span>)<span class="ot">,</span></span>
<span id="cb3-18"><a aria-hidden="true" href="#cb3-18" tabindex="-1"></a>        ]<span class="ot">,</span></span>
<span id="cb3-19"><a aria-hidden="true" href="#cb3-19" tabindex="-1"></a>    ]<span class="ot">,</span></span>
<span id="cb3-20"><a aria-hidden="true" href="#cb3-20" tabindex="-1"></a>]<span class="ot">;</span></span></code></pre>
              </div>

              <p>
                That’s it, you’re done the setup! Don’t forget to set up your environment variables for production.
              </p>

              <h3 id="creating-a-mailer">
                Creating a Mailer
              </h3>

              <p>
                Now that we’re setup, you can create a mailer in <code>app/Mail/</code>, here’s an example to go by
                (<code>app/Mail/Winnings</code>):
              </p>

              <div class="sourceCode" id="cb4">
                <pre class="sourceCode php"><code class="sourceCode php"><span id="cb4-1"><a aria-hidden="true" href=
                "#cb4-1" tabindex="-1"></a><span class="kw">&lt;?php</span> <span class=
                "kw">namespace</span> <span class="cn">A</span>pp\<span class="fu">Mail</span><span class=
                "ot">;</span></span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3" tabindex="-1"></a><span class="kw">use</span> <span class=
"cn">I</span>lluminate\<span class="cn">B</span>us\<span class="cn">Q</span>ueueable<span class="ot">;</span></span>
<span id="cb4-4"><a aria-hidden="true" href="#cb4-4" tabindex="-1"></a><span class="kw">use</span> <span class=
"cn">I</span>lluminate\<span class="fu">Mail</span>\<span class="cn">M</span>ailable<span class="ot">;</span></span>
<span id="cb4-5"><a aria-hidden="true" href="#cb4-5" tabindex="-1"></a><span class="kw">use</span> <span class=
"cn">I</span>lluminate\<span class="cn">Q</span>ueue\<span class="cn">S</span>erializesModels<span class=
"ot">;</span></span>
<span id="cb4-6"><a aria-hidden="true" href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a aria-hidden="true" href="#cb4-7" tabindex="-1"></a><span class="kw">class</span> <span class=
"cn">W</span>innings <span class="kw">extends</span> <span class="cn">M</span>ailable</span>
<span id="cb4-8"><a aria-hidden="true" href="#cb4-8" tabindex="-1"></a>{</span>
<span id="cb4-9"><a aria-hidden="true" href="#cb4-9" tabindex="-1"></a>    <span class="kw">use</span> <span class=
"cn">Q</span>ueueable<span class="ot">,</span> <span class="cn">S</span>erializesModels<span class="ot">;</span></span>
<span id="cb4-10"><a aria-hidden="true" href="#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a aria-hidden="true" href="#cb4-11" tabindex="-1"></a>    <span class="co">/** </span><span class=
"an">@var</span><span class="co"> </span><span class="do">string</span><span class="co"> </span><span class=
"do">the</span><span class="co"> </span><span class="do">address</span><span class="co"> </span><span class=
"do">to</span><span class="co"> </span><span class="do">send</span><span class="co"> </span><span class=
"do">the</span><span class="co"> </span><span class="do">email</span><span class="co"> */</span></span>
<span id="cb4-12"><a aria-hidden="true" href="#cb4-12" tabindex="-1"></a>    <span class=
"kw">protected</span> <span class="va">$to_address</span><span class="ot">;</span></span>
<span id="cb4-13"><a aria-hidden="true" href="#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a aria-hidden="true" href="#cb4-14" tabindex="-1"></a>    <span class="co">/** </span><span class=
"an">@var</span><span class="co"> </span><span class="do">float</span><span class="co"> </span><span class=
"do">the</span><span class="co"> </span><span class="do">winnings</span><span class="co"> </span><span class=
"do">they</span><span class="co"> </span><span class="do">won</span><span class="co"> */</span></span>
<span id="cb4-15"><a aria-hidden="true" href="#cb4-15" tabindex="-1"></a>    <span class=
"kw">protected</span> <span class="va">$winnings</span><span class="ot">;</span></span>
<span id="cb4-16"><a aria-hidden="true" href="#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a aria-hidden="true" href="#cb4-17" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb4-18"><a aria-hidden="true" href="#cb4-18" tabindex="-1"></a><span class=
"co">     * Create a new message instance.</span></span>
<span id="cb4-19"><a aria-hidden="true" href="#cb4-19" tabindex="-1"></a><span class="co">     *</span></span>
<span id="cb4-20"><a aria-hidden="true" href="#cb4-20" tabindex="-1"></a><span class="co">     * </span><span class=
"an">@param</span><span class="co"> </span><span class="cv">string</span><span class=
"co"> $to_address the address to send the email</span></span>
<span id="cb4-21"><a aria-hidden="true" href="#cb4-21" tabindex="-1"></a><span class="co">     * </span><span class=
"an">@param</span><span class="co"> </span><span class="cv">float</span><span class=
"co"> $winnings   the winnings they won</span></span>
<span id="cb4-22"><a aria-hidden="true" href="#cb4-22" tabindex="-1"></a><span class="co">     * </span></span>
<span id="cb4-23"><a aria-hidden="true" href="#cb4-23" tabindex="-1"></a><span class="co">     * </span><span class=
"an">@return</span><span class="co"> void</span></span>
<span id="cb4-24"><a aria-hidden="true" href="#cb4-24" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb4-25"><a aria-hidden="true" href="#cb4-25" tabindex="-1"></a>    <span class=
"kw">public</span> <span class="kw">function</span> <span class="bu">__construct</span>(<span class=
"va">$to_address</span><span class="ot">,</span> <span class="va">$winnings</span>)</span>
<span id="cb4-26"><a aria-hidden="true" href="#cb4-26" tabindex="-1"></a>    {</span>
<span id="cb4-27"><a aria-hidden="true" href="#cb4-27" tabindex="-1"></a>        <span class=
"va">$this</span>-&gt;to_address <span class="op">=</span> <span class="va">$to_address</span><span class=
"ot">;</span></span>
<span id="cb4-28"><a aria-hidden="true" href="#cb4-28" tabindex="-1"></a>        <span class=
"va">$this</span>-&gt;winnings <span class="op">=</span> <span class="va">$winnings</span><span class=
"ot">;</span></span>
<span id="cb4-29"><a aria-hidden="true" href="#cb4-29" tabindex="-1"></a>    }</span>
<span id="cb4-30"><a aria-hidden="true" href="#cb4-30" tabindex="-1"></a></span>
<span id="cb4-31"><a aria-hidden="true" href="#cb4-31" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb4-32"><a aria-hidden="true" href="#cb4-32" tabindex="-1"></a><span class=
"co">     * Build the message.</span></span>
<span id="cb4-33"><a aria-hidden="true" href="#cb4-33" tabindex="-1"></a><span class="co">     *</span></span>
<span id="cb4-34"><a aria-hidden="true" href="#cb4-34" tabindex="-1"></a><span class="co">     * </span><span class=
"an">@return</span><span class="co"> $this</span></span>
<span id="cb4-35"><a aria-hidden="true" href="#cb4-35" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb4-36"><a aria-hidden="true" href="#cb4-36" tabindex="-1"></a>    <span class=
"kw">public</span> <span class="kw">function</span> build()</span>
<span id="cb4-37"><a aria-hidden="true" href="#cb4-37" tabindex="-1"></a>    {</span>
<span id="cb4-38"><a aria-hidden="true" href="#cb4-38" tabindex="-1"></a>        <span class=
"cf">return</span> <span class="va">$this</span></span>
<span id="cb4-39"><a aria-hidden="true" href="#cb4-39" tabindex="-1"></a>            -&gt;to(<span class=
"va">$this</span>-&gt;to_address)</span>
<span id="cb4-40"><a aria-hidden="true" href="#cb4-40" tabindex="-1"></a>            -&gt;subject(<span class=
"st">'Your winnings!'</span>)</span>
<span id="cb4-41"><a aria-hidden="true" href="#cb4-41" tabindex="-1"></a>            -&gt;view(<span class=
"st">'emails.winnings'</span>)</span>
<span id="cb4-42"><a aria-hidden="true" href="#cb4-42" tabindex="-1"></a>            -&gt;with(</span>
<span id="cb4-43"><a aria-hidden="true" href="#cb4-43" tabindex="-1"></a>                [</span>
<span id="cb4-44"><a aria-hidden="true" href="#cb4-44" tabindex="-1"></a>                    <span class=
"st">'winnings'</span> =&gt; <span class="va">$this</span>-&gt;winnings</span>
<span id="cb4-45"><a aria-hidden="true" href="#cb4-45" tabindex="-1"></a>                ]</span>
<span id="cb4-46"><a aria-hidden="true" href="#cb4-46" tabindex="-1"></a>            )<span class="ot">;</span></span>
<span id="cb4-47"><a aria-hidden="true" href="#cb4-47" tabindex="-1"></a>    }</span>
<span id="cb4-48"><a aria-hidden="true" href="#cb4-48" tabindex="-1"></a>}</span></code></pre>
              </div>

              <p>
                Now, create a view, <code>resources/views/emails/winnings.blade.php</code> for simply HTML-only,:
              </p>

              <div class="sourceCode" id="cb5">
                <pre class="sourceCode html"><code class="sourceCode html"><span id="cb5-1"><a aria-hidden="true" href=
                "#cb5-1" tabindex="-1"></a>{% raw %}<span class="dt">&lt;</span><span class=
                "kw">strong</span><span class="dt">&gt;</span>You won {{ $winnings }}<span class=
                "dt">&lt;/</span><span class="kw">strong</span><span class=
                "dt">&gt;</span>!{% endraw %}</span></code></pre>
              </div>

              <h2 id="sending-mail">
                Sending Mail
              </h2>

              <p>
                Now that we have it setup, and a mailable created, we can send. In your job, controller, or where ever
                you need it:
              </p>

              <div class="sourceCode" id="cb6">
                <pre class="sourceCode php"><code class="sourceCode php"><span id="cb6-1"><a aria-hidden="true" href=
                "#cb6-1" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb6-2"><a aria-hidden="true" href="#cb6-2" tabindex="-1"></a><span class="kw">use</span> <span class=
"cn">A</span>pp\<span class="fu">Mail</span>\<span class="cn">W</span>innings <span class="kw">as</span> <span class=
"cn">W</span>inningsMail<span class="ot">;</span></span>
<span id="cb6-3"><a aria-hidden="true" href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a aria-hidden="true" href="#cb6-4" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb6-5"><a aria-hidden="true" href="#cb6-5" tabindex="-1"></a><span class=
"co">// $to_email = 'john@doe.com'; $winnings = 130.00;</span></span>
<span id="cb6-6"><a aria-hidden="true" href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a aria-hidden="true" href="#cb6-7" tabindex="-1"></a><span class="fu">Mail</span>::send(</span>
<span id="cb6-8"><a aria-hidden="true" href="#cb6-8" tabindex="-1"></a>    <span class="kw">new</span> <span class=
"cn">W</span>inningsMail(</span>
<span id="cb6-9"><a aria-hidden="true" href="#cb6-9" tabindex="-1"></a>        <span class=
"va">$to_email</span><span class="ot">,</span></span>
<span id="cb6-10"><a aria-hidden="true" href="#cb6-10" tabindex="-1"></a>        <span class=
"va">$winnings</span></span>
<span id="cb6-11"><a aria-hidden="true" href="#cb6-11" tabindex="-1"></a>    )</span>
<span id="cb6-12"><a aria-hidden="true" href="#cb6-12" tabindex="-1"></a>)<span class="ot">;</span></span></code></pre>
              </div>

              <p>
                If you’re queuing mail, replace <code>send</code> with <code>queue</code>. You can also see <a href=
                "https://laravel.com/docs/5.5/mail#sending-mail">Laravel’s mail documentation</a> for more information
                on sending.
              </p>

              <h2 id="testing">
                Testing
              </h2>

              <p>
                Of course, we need to test (<code>tests/WinningsMailTest.php</code>):
              </p>

              <div class="sourceCode" id="cb7">
                <pre class="sourceCode php"><code class="sourceCode php"><span id="cb7-1"><a aria-hidden="true" href=
                "#cb7-1" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb7-2"><a aria-hidden="true" href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a aria-hidden="true" href="#cb7-3" tabindex="-1"></a><span class="kw">use</span> <span class=
"cn">A</span>pp\<span class="fu">Mail</span>\<span class="cn">W</span>innings<span class="ot">;</span></span>
<span id="cb7-4"><a aria-hidden="true" href="#cb7-4" tabindex="-1"></a><span class="kw">use</span> <span class=
"cn">I</span>lluminate\<span class="cn">S</span>upport\<span class="cn">F</span>acades\<span class=
"fu">Mail</span><span class="ot">;</span></span>
<span id="cb7-5"><a aria-hidden="true" href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a aria-hidden="true" href="#cb7-6" tabindex="-1"></a><span class="kw">class</span> <span class=
"cn">W</span>inningsMailTest <span class="kw">extends</span> <span class="cn">T</span>estCase</span>
<span id="cb7-7"><a aria-hidden="true" href="#cb7-7" tabindex="-1"></a>{</span>
<span id="cb7-8"><a aria-hidden="true" href="#cb7-8" tabindex="-1"></a>    <span class="kw">public</span> <span class=
"kw">function</span> testItWorks()</span>
<span id="cb7-9"><a aria-hidden="true" href="#cb7-9" tabindex="-1"></a>    {</span>
<span id="cb7-10"><a aria-hidden="true" href="#cb7-10" tabindex="-1"></a>        <span class=
"fu">Mail</span>::fake()<span class="ot">;</span></span>
<span id="cb7-11"><a aria-hidden="true" href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a aria-hidden="true" href="#cb7-12" tabindex="-1"></a>        <span class=
"fu">Mail</span>::send(</span>
<span id="cb7-13"><a aria-hidden="true" href="#cb7-13" tabindex="-1"></a>            (<span class=
"kw">new</span> <span class="cn">W</span>innings(<span class="st">'john@doe.com'</span><span class=
"ot">,</span> <span class="fl">15.00</span>))-&gt;build()</span>
<span id="cb7-14"><a aria-hidden="true" href="#cb7-14" tabindex="-1"></a>        )<span class="ot">;</span></span>
<span id="cb7-15"><a aria-hidden="true" href="#cb7-15" tabindex="-1"></a></span>
<span id="cb7-16"><a aria-hidden="true" href="#cb7-16" tabindex="-1"></a>        <span class=
"fu">Mail</span>::assertSent(<span class="cn">W</span>innings::<span class="kw">class</span><span class=
"ot">,</span> <span class="kw">function</span> (<span class="va">$mail</span>) {</span>
<span id="cb7-17"><a aria-hidden="true" href="#cb7-17" tabindex="-1"></a>            <span class=
"cf">return</span> <span class="va">$mail</span>-&gt;hasTo(<span class="st">'john@doe.com'</span>) <span class=
"op">&amp;&</span></span>
<span id="cb7-18"><a aria-hidden="true" href="#cb7-18" tabindex="-1"></a>                   <span class=
"va">$mail</span>-&gt;subject <span class="op">===</span> <span class="st">'Your winnings!'</span> <span class=
"op">&amp;&</span></span>
<span id="cb7-19"><a aria-hidden="true" href="#cb7-19" tabindex="-1"></a>                   <span class=
"va">$mail</span>-&gt;viewData[<span class="st">'winnings'</span>] <span class="op">===</span> <span class=
"fl">15.00</span><span class="ot">;</span></span>
<span id="cb7-20"><a aria-hidden="true" href="#cb7-20" tabindex="-1"></a>        })<span class="ot">;</span></span>
<span id="cb7-21"><a aria-hidden="true" href="#cb7-21" tabindex="-1"></a>    }</span>
<span id="cb7-22"><a aria-hidden="true" href="#cb7-22" tabindex="-1"></a>}</span></code></pre>
              </div>

              <p>
                Running the tests should pass if everything is set up correctly. For more information on testing
                mailables, see <a href="https://laravel.com/docs/5.5/mocking#mail-fake">Laravel’s documentation on
                faking</a>.
              </p>

              <p>
                I hope this was a quick and useful setup for anyone having issues. Good luck!
              </p>
            </div>
          </div>
        </div>
      </article>

      <section class="tab tab--anchors">
        <div class="tab__title tab__title--short">
          Anchors
        </div>

        <div class="tab__container">
          <div class="tab__content">
            <ul class="anchors-list">
              <li class="anchors-list__item">
                <strong>[1]</strong> <a class="sources__link anchors-list__link" href="https://lumen.laravel.com/" rel=
                "noopener" target="_parent">lumen.laravel.com/</a> ↗
              </li>

              <li class="anchors-list__item">
                <strong>[2]</strong> <a class="sources__link anchors-list__link" href=
                "https://laravel.com/docs/5.5/mail#sending-mail" rel="noopener" target=
                "_parent">laravel.com/docs/5.5/mail#sending-mail</a> ↗
              </li>

              <li class="anchors-list__item">
                <strong>[3]</strong> <a class="sources__link anchors-list__link" href=
                "https://laravel.com/docs/5.5/mocking#mail-fake" rel="noopener" target=
                "_parent">laravel.com/docs/5.5/mocking#mail-fake</a> ↗
              </li>
            </ul>
          </div>
        </div>
      </section>

      <section class="tab tab--appendix">
        <div class="tab__title tab__title--short">
          Appendix
        </div>

        <div class="tab__container">
          <div class="tab__content">
            <div class="content-container">
              <p class="warning warning--post">
                This post is 7 years old and may contain outdated information.
              </p>

              <p>
                Copyright under <a class="sources__link" href="https://creativecommons.org/licenses/by/4.0/" rel=
                "noopener" target="_blank">CC-4.0</a>.
              </p>

              <p>
                Available in the following alternative formats: <span class="sources"><a class="sources__link" href=
                "/setting-up-lumen-with-mail/index.md">MD</a>&nbsp;&nbsp;/&nbsp;&nbsp;<a class="sources__link" href=
                "/setting-up-lumen-with-mail/index.txt">TXT</a>&nbsp;&nbsp;/&nbsp;&nbsp;<a class="sources__link" href=
                "#" onclick="window.print(); return false;">PDF</a></span>
              </p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <ul class="site-colors container container--short">
      <li class="site-colors__color color--a">
      </li>

      <li class="site-colors__color color--b">
      </li>

      <li class="site-colors__color color--c">
      </li>

      <li class="site-colors__color color--d">
      </li>

      <li class="site-colors__color color--e">
      </li>

      <li class="site-colors__color color--f">
      </li>

      <li class="site-colors__color color--g">
      </li>

      <li class="site-colors__color color--h">
      </li>
    </ul>
  </body>
</html>
