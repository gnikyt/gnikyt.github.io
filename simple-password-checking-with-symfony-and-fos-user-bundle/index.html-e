<!DOCTYPE html>
<html>
<head>
	<!-- Theme: Attila by zutrinken, powered by: Ghost -->
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Simple Password Checking with Symfony and FOS User Bundle</title>

	<meta name="HandheldFriendly" content="True" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link rel="stylesheet" type="text/css" href="../assets/css/style.css?v=4f8314772c" />

	<link rel="shortcut icon" href="../favicon.png" type="image/png" />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:site_name" content="OhMyBrew!" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Simple Password Checking with Symfony and FOS User Bundle" />
    <meta property="og:description" content="Recently for a project, a co-developer wanted to validate someone&#x27;s record in the database from an Android application and the website was using Symfony 2.3 with FOS User Bundle. Specifically this developer did not want to log the user in, only to check their login against the database. So" />
    <meta property="og:url" content="https://ohmybrew.com/simple-password-checking-with-symfony-and-fos-user-bundle/" />
    <meta property="og:image" content="https://ohmybrew.com/content/images/2018/02/chris-yang-422605-unsplash.jpg" />
    <meta property="article:published_time" content="2013-08-28T16:22:49.000Z" />
    <meta property="article:modified_time" content="2018-02-21T01:44:43.000Z" />
    <meta property="article:tag" content="tip" />
    <meta property="article:tag" content="programming" />
    <meta property="article:tag" content="php" />
    <meta property="article:tag" content="symfony" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Simple Password Checking with Symfony and FOS User Bundle" />
    <meta name="twitter:description" content="Recently for a project, a co-developer wanted to validate someone&#x27;s record in the database from an Android application and the website was using Symfony 2.3 with FOS User Bundle. Specifically this developer did not want to log the user in, only to check their login against the database. So" />
    <meta name="twitter:url" content="https://ohmybrew.com/simple-password-checking-with-symfony-and-fos-user-bundle/" />
    <meta name="twitter:image" content="https://ohmybrew.com/content/images/2018/02/chris-yang-422605-unsplash.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Tyler King" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="tip, programming, php, symfony" />
    <meta property="og:image:width" content="7952" />
    <meta property="og:image:height" content="5304" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "OhMyBrew!",
        "logo": {
            "@type": "ImageObject",
            "url": "https://ohmybrew.com/favicon.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Tyler King",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/b866d161c9f02b7384a0940cb07135bc?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://ohmybrew.com/author/tyler-king/",
        "sameAs": [
            "https://ohmybrew.com"
        ]
    },
    "headline": "Simple Password Checking with Symfony and FOS User Bundle",
    "url": "https://ohmybrew.com/simple-password-checking-with-symfony-and-fos-user-bundle/",
    "datePublished": "2013-08-28T16:22:49.000Z",
    "dateModified": "2018-02-21T01:44:43.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://ohmybrew.com/content/images/2018/02/chris-yang-422605-unsplash.jpg",
        "width": 7952,
        "height": 5304
    },
    "keywords": "tip, programming, php, symfony",
    "description": "Recently for a project, a co-developer wanted to validate someone&#x27;s record in the database from an Android application and the website was using Symfony 2.3 with FOS User Bundle. Specifically this developer did not want to log the user in, only to check their login against the database. So",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://ohmybrew.com/"
    }
}
    </script>

    <script type="text/javascript" src="../public/ghost-sdk.js?v=4f8314772c"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "af2244026b4c"
});
</script>
    <meta name="generator" content="Ghost 1.21" />
    <link rel="alternate" type="application/rss+xml" title="OhMyBrew!" href="../rss/index.html" />
    <script async src="https://www.google-analytics.com/analytics.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-101589108-1', 'auto');
    ga('send', 'pageview');
</script>
</head>

<body class="post-template tag-tip tag-programming tag-php tag-symfony">
	
	<nav id="menu">
	<a class="close-button">Close</a>
	<div class="nav-wrapper">
		<p class="nav-label">Menu</p>
		<ul>
			<li class="nav-home" role="presentation"><a href="../index.html">Home</a></li>
			<li class="nav-github" role="presentation"><a href="https://github.com/ohmybrew"><i class="ic ic-star"></i> Github</a></li>
			
			<li class="nav-rss"><a href="../rss/index.html"><i class="ic ic-rss"></i> Subscribe</a></li>
		</ul>
	</div>
</nav>
	
	<section id="wrapper">
		<a class="hidden-close"></a>
		

<div class="progress-container">
	<span class="progress-bar"></span>
</div>

<header id="post-header" class="has-cover" >
	<div class="inner">
		<nav id="navigation">
			<span id="home-button" class="nav-button">
				<a class="home-button" href="../index.html" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
			</span>
			<span id="menu-button" class="nav-button">
				<a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
			</span>
		</nav>
		<h1 class="post-title">Simple Password Checking with Symfony and FOS User Bundle</h1>
		<span class="post-meta"><a href="../author/tyler-king/index.html">Tyler King</a> | <time datetime="2013-08-28">28 Aug 2013</time></span>
		<div class="post-cover cover" style="background-image: url('../content/images/2018/02/chris-yang-422605-unsplash.jpg');"></div>
	</div>
</header>

<main class="content" role="main">
	<article class="post tag-tip tag-programming tag-php tag-symfony">
		<div class="inner">

			<section class="post-content">
				<div class="kg-card-markdown"><p>Recently for a project, a co-developer wanted to validate someone's record in the database from an Android application and the website was using Symfony 2.3 with FOS User Bundle. Specifically this developer did not want to log the user in, only to check their login against the database. So this seemed like a special enough case to show my solution to the problem.</p>
<p>We were going to tackle this by an HTTP POST request to /login_check, with the user's email and password. Now, FOS User Bundle is highly configurable. At first, I considered extending the authentication handler and tapping into <code>onAuthenticationSuccess</code> and <code>onAuthenticationFailure</code>. By extending the authentication handler, I could now check for an external request from the Android application, and provide a JSON response for the POST data - showing if it was a valid login or not.</p>
<p>This provided a problem however, FOS User Bundle uses CSRF tokens on the login to prevent these kinds of HTTP requests, which is nice. But, in order to disable it so the Android application could externally call /login_check on the website, I would have to extend the security form controller for FOS User Bundle in SecurityController.php, and to do that you need to create a new bundle which is a child of FOSUserBundle. On top of that, then we have a security issue where we have no CSRF protection.</p>
<p>That's a lot of work just to respond to a HTTP request and let the application know of the email and password match the database.</p>
<p>So my solution was simple; take the user's email, validate it, then take the password and use Symfony's encoder service to hash the password sent to the controller for that email and check if it's valid.</p>
<p>Here is the controller code below. In my code I added a &quot;android_secret&quot; parameter read from app/parameters.yml which is a hash that just ensures the request came from the Android application - this is unnecessary and can be removed if you please.</p>
<pre><code class="language-php">&lt;?php

namespace Acme\WebsiteBundle\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;

class AndroidController extends Controller
{
  public function checkLoginAction(Request $request)
  {
	// Get our POST data.
    $email    = $request-&gt;request-&gt;get('email');
    $password = $request-&gt;request-&gt;get('password');
    $secret   = $request-&gt;request-&gt;get('secret');

	// Setup the JSON messages.
    $messages = [
      'success' =&gt; [
        'success' =&gt; true,
        'message' =&gt; 'VALID_LOGIN'
      ],
      'fail'    =&gt; [
        'success' =&gt; false,
        'message' =&gt; 'INVALID_LOGIN'
      ],
      'secret'  =&gt; [
        'success' =&gt; false,
        'message' =&gt; 'INVALID_AUTH'
      ]
    ];

    $type           = 'application/json';
    $return_success = json_encode($messages['success']);
    $return_fail    = json_encode($messages['fail']);
    $return_secret  = json_encode($messages['secret']);

	// Ensure this is from the Android application.
    if ($this-&gt;container-&gt;getParameter('android_secret') !== $secret) {
      return new Response($return_secret, 200, ['Content-Type' =&gt; $type]);
    }

	// Check the email sent to us.
    $user = $this-&gt;get('fos_user.user_manager')-&gt;findUserByEmail($email);
    if (null === $user) {
      return new Response($return_fail, 200, ['Content-Type' =&gt; $type]);
    }

	// Email passed. Let's encode the password sent to us using the user's salt.
    $encoder      = $this-&gt;get('security.encoder_factory')-&gt;getEncoder($user);
    $encoded_pass = $encoder-&gt;encodePassword($password, $user-&gt;getSalt());

	// Check if the password sent to us matches encoded_pass we just created.
    if ($encoded_pass === $user-&gt;getPassword()) {
    // Passed!
      return new Response($return_success, 200, ['Content-Type' =&gt; $type]);
    }

	// Failed!
    return new Response($return_fail, 200, ['Content-Type' =&gt; $type]);
  }
}
</code></pre>
<hr>
<p><em>Cover image credit to: <a href="https://unsplash.com/photos/0JhaVZUowWU">Chris Yang</a></em></p>
</div>
			</section>

			<section class="post-info">

				<div class="post-share">
					<a class="twitter" href="https://twitter.com/share?text=Simple Password Checking with Symfony and FOS User Bundle&url=https://ohmybrew.com/simple-password-checking-with-symfony-and-fos-user-bundle/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
						<i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
					</a>
					<a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://ohmybrew.com/simple-password-checking-with-symfony-and-fos-user-bundle/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
						<i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
					</a>
					<a class="googleplus" href="https://plus.google.com/share?url=https://ohmybrew.com/simple-password-checking-with-symfony-and-fos-user-bundle/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
						<i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
					</a>
					<div class="clear"></div>
				</div>

				<aside class="post-tags">
					<a href="../tag/tip/index.html">tip</a> <a href="../tag/programming/index.html">programming</a> <a href="../tag/php/index.html">php</a> <a href="../tag/symfony/index.html">symfony</a>
				</aside>

				<div class="clear"></div>

				<aside class="post-author">
					<figure class="post-author-avatar avatar">
							<img src="http://www.gravatar.com/avatar/b866d161c9f02b7384a0940cb07135bc?s=250&amp;d=mm&amp;r=x" alt="Tyler King" />
					</figure>
					<div class="post-author-bio">
						<h4 class="post-author-name"><a href="../author/tyler-king/index.html">Tyler King</a></h4>
							<p class="post-author-about">I'm a loving father, passionate homebrewer, motorcycle rider, and of course.. a coder. I develop solutions through experience.</p>
							<span class="post-author-location"><i class="ic ic-location"></i> Newfoundland</span>
							<span class="post-author-website"><i class="ic ic-link"></i> <a href="https://ohmybrew.com">Website</a></span>
					</div>
					<div class="clear"></div>
				</aside>

			</section>


			<section class="post-comments">
				<a id="show-disqus" class="post-comments-activate">Show Comments</a>
			    <div id="disqus_thread"></div>
			</section>


			<aside class="post-nav">
					<a class="post-nav-next" href="../happy-4th-birthday-to-my-girl/index.html">
						<section class="post-nav-teaser">
							<i class="ic ic-arrow-left"></i>
							<h2 class="post-nav-title">Happy 4th Birthday to My Girl!</h2>
							<p class="post-nav-excerpt">&hellip;</p>
						</section>
					</a>
					<a class="post-nav-prev" href="../gathering-user-input-with-shopify/index.html">
						<section class="post-nav-teaser">
							<i class="ic ic-arrow-right"></i>
							<h2 class="post-nav-title">Gathering User-Input with Shopify</h2>
							<p class="post-nav-excerpt">Shopify includes everything you need to setup an online store, including free&hellip;</p>
						</section>
					</a>
				<div class="clear"></div>
			</aside>


		</div>
	</article>
</main>


		<div id="body-class" style="display: none;" class="post-template tag-tip tag-programming tag-php tag-symfony"></div>
	
		<footer id="footer">
			<div class="inner">
			</div>
		</footer>
	</section>

	<script type="text/javascript" src="../assets/js/script.js?v=4f8314772c"></script>

	
</body>
</html>
